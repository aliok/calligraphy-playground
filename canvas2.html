<!DOCTYPE html>
<html>
<body>

<button id="addButton">Add</button>

<canvas id="c" style="border: 1px solid green; width: 500px; height: 500px;"></canvas>
</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script type="text/javascript" src="fabric.js"></script>

<script>

</script>

<script>
    (function () {

        var canvas = this.__canvas = new fabric.Canvas('c', { selection: false, width: 500, height: 500 });

        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';


        var LabeledRect = fabric.util.createClass(fabric.Rect, {

            type: 'labeledRect',

            initialize: function (options) {
                options || (options = { });

                this.callSuper('initialize', options);
                this.set('label', options.label || '');
            },

            toObject: function () {
                return fabric.util.object.extend(this.callSuper('toObject'), {
                    label: this.get('label')
                });
            },

            _render: function (ctx) {
                this.callSuper('_render', ctx);

                ctx.font = '20px Helvetica';
                ctx.fillStyle = '#333';
                ctx.fillText(this.label, -this.width / 2, -this.height / 2 + 20);
            }
        });

        var labeledRect = new LabeledRect({
            width: 100,
            height: 50,
            left: 100,
            top: 100,
            label: 'test',
            fill: '#faa'
        });
        canvas.add(labeledRect);

        console.log('createClass');
        var FreeLine = fabric.util.createClass(fabric.Object, {

            type: 'freeLine',

            initialize: function (points, options) {
                console.log('initialize');
                options = options || { };

                if (!points) {
                    points = [0, 0, 0, 0];
                }

                this.callSuper('initialize', options);

                this.set('x1', points[0]);
                this.set('y1', points[1]);
                this.set('x2', points[2]);
                this.set('y2', points[3]);

                this._setWidthHeight(options);
            },

            toObject: function () {
                console.log('toObject');
                return {
                    x1: this.x1,
                    x2: this.x2,
                    y1: this.y1,
                    y2: this.y2
                };
            },

            _render: function (ctx) {
                console.log('render');
                this.callSuper('_render', ctx);

                ctx.font = '20px Helvetica';
                ctx.fillStyle = '#333';
                ctx.fillText("adssad", 200, 300);
            }

        });

        var freeLine = new FreeLine([100, 200, 300, 400]);
        canvas.add(freeLine);


    })();
</script>

</html>