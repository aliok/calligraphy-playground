<!DOCTYPE html>
<html>
<body>

<button id="addButton">Add</button>

<canvas id="c" style="border: 1px solid green; width: 500px; height: 500px;"></canvas>
</body>

<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.1.js"></script>
<script type="text/javascript" src="fabric.js"></script>

<script>

</script>

<script>
    (function () {

        var canvas = this.__canvas = new fabric.Canvas('c', { selection: false, width: 500, height: 500 });

        fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';

        canvas.on('mouse:down', function (options) {
            if (options.target) {
                console.log('an object was clicked! ', options.target.type);
            }
        });

        $("#addButton").on('click', function (e) {
            var c = new fabric.Rect({
                left: 100,
                top: 100,
                width: 5,
                height: 100,
                lockScalingX: true,
                hasBorders: false,
                strokeWidth: 1,
                fill: 'red',
                stroke: 'red'
            });

            c.setControlsVisibility(
                    {
                        "bl": false,
                        "br": false,
                        "mb": true,
                        "ml": false,
                        "mr": false,
                        "mt": true,
                        "tl": false,
                        "tr": false,
                        "mtr": true
                    }
            );

            canvas.add(c);

            var c = new fabric.Line([100, 200, 300, 400], {
                fill: 'red',
                stroke: 'red',
                strokeWidth: 5
            });

            canvas.add(c);
        });

        function makeCircle(left, top, line1, line2, line3, line4) {
            var c = new fabric.Circle({
                left: left,
                top: top,
                strokeWidth: 5,
                radius: 12,
                fill: '#fff',
                stroke: '#666'
            });
            c.hasControls = c.hasBorders = false;

            c.line1 = line1;
            c.line2 = line2;

            return c;
        }

        function makeLine(coords) {
            return new fabric.Line(coords, {
                fill: 'red',
                stroke: 'red',
                strokeWidth: 5,
                selectable: false
            });
        }

        var line = makeLine([ 250, 125, 250, 175 ]);


        canvas.add(line);

        canvas.add(
                makeCircle(line.get('x1'), line.get('y1'), null, line),
                makeCircle(line.get('x2'), line.get('y2'), line)
        );

        canvas.on('object:moving', function (e) {
            var p = e.target;
            p.line1 && p.line1.set({ 'x2': p.left, 'y2': p.top });
            p.line2 && p.line2.set({ 'x1': p.left, 'y1': p.top });
            canvas.renderAll();
        });
    })();
</script>

</html>